<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Computer Science Large Practical: Computer Science Large Practical</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Computer Science Large Practical
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Computer Science Large Practical </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>This is the program for 2012 Computer Science Large Practical as set out in the <a href="http://www.inf.ed.ac.uk/teaching/courses/cslp/coursework/CSLP-2012.pdf">Handout</a></p>
<p>This file is written using <a href="http://daringfireball.net/projects/markdown/">Markdown</a>. While you can convert it to html using <a href="http://daringfireball.net/projects/markdown/">Markdown.pl</a> or any other converter it is integrated with doxygen and appears as the main page of the doxygen documentation and also bundled as a pdf</p>
<h1>Building</h1>
<p>The program requires GNUstep and was built on Ubuntu 12.10 and Arch Linux.</p>
<p>Ensure you have run GNUstep.sh to setup your environmental variables. <a href="http://www.gnustep.org/resources/documentation/User/GNUstep/gnustep-howto_4.html">See the GNUstep documentation for more details</a></p>
<p><code>cd</code> into the root of the Cslp directory and run <code>make</code>. This will build the binary and write it to <code>Cslp.app/Cslp</code>.</p>
<h1>Building Documentation</h1>
<p>Documentation for the project can be built using <code>make docs</code>. This requires:</p>
<ul>
<li><a href="https://github.com/walle/gimli">gimli</a></li>
<li><code>sed</code> and <code>rm</code> (Obviously should be installed)</li>
<li><a href="http://www.doxygen.org">Doxygen</a> 1.8 or greater</li>
<li>Graphviz</li>
<li><a href="https://github.com/sunaku/md2man">md2man</a></li>
</ul>
<p>Due to these requirements, the documentation has been prebuilt</p>
<p>(Note: There are a lot of warnings when building the doxygen documentation. Partly this is because the configuration file is for a newer version of doxygen than is included with Ubuntu and also because I didn't and don't intend to document everything. For example in most cases it should be clear what <code>-(void)dealloc;</code> does and documentation adds nothing).</p>
<h1>Documentation</h1>
<p>Other than this document there is the man page. As this program lacks an installer (The current development system is not the same as the system that will mark it and packages are a different format) the man page is viewable via <code>man -l doc/CSLP.1</code></p>
<p>Documentation for the code (generated using doxygen) can be accessed from the <a href="codedocs.html">codedocs.html</a> file found in the <code>doc</code> directory.</p>
<h1>Running the Application</h1>
<p>The Unix way of running the program is to pass the program the input script through stdin and let the program write the output to stdout. For example: <code>cat ./examples/decay.txt | ./Cslp.app/Cslp</code></p>
<p>Due to the requirements of the application it is also possible to pass as the first argument the path to the file to read. For example: <code>./Cslp.app/Cslp exampes/decay.txt</code></p>
<p>If you want to output elsewhere than stdout then the following are equivalent: <code>./Cslp.app/Cslp exampes/decay.txt &gt; output.txt</code> <code>./Cslp.app/Cslp exampes/decay.txt --output output.txt</code></p>
<h1>Command Line Arguments</h1>
<p>Run <code>./Cslp.app/Cslp --help</code> to see an up to date list of command line options</p>
<h1>Configuration Script</h1>
<p>The configuration script is the same as described in the Handout, but with the following differences.</p>
<ul>
<li>Identifiers must be consistent but you can use words as opposed to letters (so you are not limited to 25 molecules)</li>
<li>t has an alias time, so both <code>t</code> and <code>time</code> are reserved identifiers</li>
<li>Comments can be written on the same line as settings</li>
<li>Support for numbers in scientific notation</li>
<li>Validation is preformed on the scripts. It should be impossible to use an invalid script and warnings are given for scripts that are have problems (it is possible to treat warnings as errors using the <code>--wall</code> command line option)</li>
</ul>
<h1>Output Formats</h1>
<p>There are two things that can effect the output, both configurable via the command line. The first is the aggregator (<code>--aggregator</code>) which can group up simulator state changes. Valid options for this are:</p>
<ul>
<li><code><a class="el" href="interfacePassthroughAggregator.html" title="All state changes are written to the output.">PassthroughAggregator</a></code> - All state changes are logged</li>
<li><code><a class="el" href="interfaceHundredMsAggregator.html" title="This writes the state at maximum once every simulated 100ms.">HundredMsAggregator</a></code> - At least a hundred ms needs to have passed for a state change to be logged</li>
<li><code><a class="el" href="interfaceExactHundredMsAggregator.html" title="This writes the state exactly once every simulated 100ms.">ExactHundredMsAggregator</a></code> - Writes the state exactly every hundred milliseconds. Possibly slightly slower than the other aggregator as it has to do more allocations</li>
<li><code><a class="el" href="interfaceResultOnlyAggregator.html" title="outputs only the result of the reaction and ignores intermediate stages">ResultOnlyAggregator</a></code> Writes the last output only</li>
</ul>
<p>The second option that can effect the output is the writer itself (<code>--writer</code>). Valid options are</p>
<ul>
<li><code><a class="el" href="interfaceAssignmentCsvWriter.html" title="Writer that outputs in the format set out in the handout (headers prefixed by #)">AssignmentCsvWriter</a></code> - Writes in the (invalid) Csv format specified by the assignment</li>
<li><code><a class="el" href="interfaceRfcCsvWriter.html" title="Writer that follows RFC 4180 to provide a standard CSV file.">RfcCsvWriter</a></code> - Csv writer that conforms to <a href="http://tools.ietf.org/html/rfc4180">RFC 4180</a></li>
</ul>
<h1>Logging</h1>
<p>It was suggested that I add logging. While I am not too fussed (I am fairly sure about the correctness of the program given the number of unit tests) I suppose it is a good idea to have.</p>
<p>As I didn't want to add huge amounts of requirements for something that would be marked (i.e. I didn't want the marker to have to spend 4+ hours setting up an environment to build the application) I wrote a very basic logging library that does what I need.</p>
<p>Logging can be enabled using command line parameters see Command Line Arguments for more details.</p>
<p>Note: Early startup errors such as incorrect command line parameters can only be logged to stderr as at this point no logs have been created.</p>
<h1>Running Tests</h1>
<p>From the project root directory run <code>gnustep-tests</code>. There are tests for most parts of the system.</p>
<p>The code quality of the tests isn't terribly high as there is quite a lot of <em>almost</em> duplicated code, this is in part due to the verboseness of Objective C in that it takes a huge number of lines to setup the state. The other issue was that I couldn't find a decent unit testing and object mocking framework that worked reliably with gnustep (despite having spent several hours trying to set some of them up). This meant that I didn't have features such as test auto discovery and methods that were automatically run before each tests.</p>
<h1>Performance</h1>
<p>The biggest performance improvement that can be done is to use the <a class="el" href="interfaceResultOnlyAggregator.html" title="outputs only the result of the reaction and ignores intermediate stages">ResultOnlyAggregator</a> aggregator as the slowest part of the system is writing the output (It isn't just the IO, string concatenation is also slow). Also if you want performance, avoid writing the results to stdout as it isn't buffered so much slower than writing to a file.</p>
<p>There are several performance enhancements to the simulation that work well with larger systems. They can be enabled via <code>--sdm</code>, <code>--ldm</code> and <code>--dependency-graph</code>. These adversely effect performance with smaller systems.</p>
<ul>
<li>SDM (Simple Direct Method) slowly sorts the list of reactions by their rate of recent occurrence.</li>
<li>LDM (Logarithmic Direct Method) preforms a binary search against the list of reactions rather than a linear search. This makes SDM useless but will probably only have a noticeable impact on performance for very large numbers of reactions</li>
<li>Dependency Graph maintains a dependency graph of what applying a reaction will effect. It uses this to minimize the number of calculations needed.</li>
</ul>
<p>I did not build a big enough system to find where one where using logarithmic search made a significant performance gain and I would suspect that with a larger number of reactions this would start to make a difference.</p>
<p>Although (I would assume) outside the scope of this project would be to write the file as binary, which would avoid the string concatenation problems (but the data would be in a less useful format). It would also be possible (on a multicore machine) to write on one thread and do the simulation on another thread, although care would have to be taken with the cost of synchronization overhead.</p>
<p>While it is (compared to the performance problem of the output) fairly minor, it would be advantageous to write the <a class="el" href="interfaceSimulator.html" title="the simulator that runs the simulation on the given input">Simulator</a> in C. This is because when using Objective C it is hard to avoid heap allocations in the simulator main loop as the Objective C container types (NSArray, NSSet etc) cannot store primitive types so have to be wrapped (for example having to create a NSValue to do a pointer lookup). I have tried to minimize this but it still occurs at various points.</p>
<p>C would also allow all the data to be stored in a continuous block of memory, which would help reduce the number of cache misses. Given that the assignment wanted the code to be Objective C, I didn't experiment with writing a version of the simulator in C although the application has designed so that it would be trivial to do (You would need to write a new version of <a class="el" href="interfaceSimulatorInternalState.html" title="this holds the internal state of the simulator and is responsible for ensuring consistency">SimulatorInternalState</a>)</p>
<h1>Other code</h1>
<p><a class="el" href="Testing_8h.html">tests/Testing.h</a> is not my code and comes from gnustep. It is a set of macros that provide helpers to test functionality (such as exceptions being raised). It is included as it doesn't seem to live in a GNUStep include directory.</p>
<h1>Coding Style</h1>
<p>Where possible I have tried to stick to a idiomatic Objective C coding style. There is one noticeable area where I haven't done so and that is with pointer variable declarations. It seems that the standard way of doing things is to declare them like so (note the position of the asterisk): </p>
<pre class="fragment">MyClass *myVariable;
</pre><p>This is a follow on from C, which for some reason that when declaring several variables of the same type on the same line, you must do so like this (note the second asterisk). </p>
<pre class="fragment">MyClass *myVariable, *myOtherVariable
</pre><p>However, it is my opinion that the <code>*</code> is part of the type, not of the name and so should live with the type information such as: </p>
<pre class="fragment">MyClass* myVariable;
</pre><p>I simply avoid declaring the multiple variables of the same type on the same line.</p>
<p>Test function names are written as <code>whatIsBeingTested_Conditions_ExpectedResult</code> which while it doesn't follow the main applications naming scheme it is worth doing for the clarity that it brings.</p>
<h1>Commenting</h1>
<p>My general view on code commenting is that if you have to comment the code <em>implementation</em> to explain what you did or why you did it then the code isn't good enough. Rather than adding a comment, it is better to fix the code. There are of course a few exceptions such as:</p>
<ul>
<li>Optimized Code</li>
<li>Code working around bugs/problems</li>
</ul>
<p>There is also the problem with comments that in effect it leads to maintaining two implementations. One being the comments and the other being the code itself. Even with the best of intentions comments will drift out of sync with the code and when that happens it leads to confusion (Which is correct? The comments or the code?).</p>
<p>This partly stems out of having worked on a large project (averaging 8 developers) with <a href="http://www.skyscanner.net">Skyscanner</a> that had almost no comments, and which tended to mean that developers couldn't write messy code and "fix" it by adding a comment and the functions tended to be cleaner. E.g. You couldn't get away with writing: </p>
<pre class="fragment">int doFoo(int time);
</pre><p>As it isn't clear what it returns and you know that it takes a time, but is it hours? decades? So you would would write: </p>
<pre class="fragment">TimeSpan* doFoo(TimeSpan* time)
</pre><p>Which adds type safety and removes ambiguity from the arguments without having to resort to comments</p>
<p>While I haven't gone to that extreme in this project, where I have thought that comments may be needed in the implementation I have instead re-factored the code to attempt to make it more readable. I also tried to avoid using primitive types where possible and instead used objects, for example <a class="el" href="interfaceTimeSpan.html" title="Represents a time interval.">TimeSpan</a>.</p>
<h1>Papers</h1>
<p>The following papers cover the performance changes I made to the Gillespie Algorithm:</p>
<ul>
<li>The sorting direct method for stochastic simulation of biochemical systems with varying reaction execution behavior - McCollum, J.M, Peterson, G.D., Cox, C.D., Simpson, M.L. and Samatova, N.F.</li>
<li>Efficient exact stochastic simulation of chemical systems with many species and many channels - Gibson, M.A. and Bruck, J.</li>
<li>Logarithmic direct method for discrete stochastic simulation of chemically reacting systems - Li, H. and Petzold, L. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Dec 13 2012 12:42:35 for Computer Science Large Practical by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
